---
- name: This Yaml is to Install frontend service
  hosts: frontend
  become: true
  vars:
    catalogue_host: catalogue-dev.daws88s.shop
  tasks:
     - name: Enable module nginx nginx:1.24
       ansible.builtin.command: dnf module enable nginx:1.24 -y

     - name: Install Module nginx
       ansible.builtin.package:
        name: nginx
        state: present

     - name: Remove default content in nginx html 
       ansible.builtin.command: rm -rf /usr/share/nginx/html/* 
    
     - name: Download package from custom url
       ansible.builtin.get_url:
        url: https://roboshop-artifacts.s3.amazonaws.com/frontend-v3.zip
        dest: /tmp/frontend.zip
    
     - name: Create Directory /app
       ansible.builtin.file:
         path: /app
         state: directory
     
     - name: Unzip zip file frontend.zip
       ansible.builtin.unarchive:
         src: /tmp/frontend.zip
         dest: /app
         remote_src: yes

     - name: Copy Catalogue service file and replace the variable
       ansible.builtin.template:
        src: nginx.conf.j2
        dest: /etc/nginx/nginx.conf
     
     - name: Enable and Start nginx
       ansible.builtin.service:
        name: nginx
        enabled: true
        state: started

      